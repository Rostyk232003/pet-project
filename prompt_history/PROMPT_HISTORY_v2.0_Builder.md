// PROMPT v2.0: Створення файлу PROMPT_HISTORY_v2.0_Builder.md
# PROMPT_HISTORY_v2.0_Builder.md

---

## [Активна] PROMPT v2.0: Реалізація патерну Builder для аналітичних звітів

**Опис:**
Запропоновано три архітектурні варіанти впровадження патерну Builder для формування аналітичних звітів у системі. Кожен варіант містить власний підхід до розширюваності, гнучкості та складності підтримки.

**Промпт:**
"Реалізуй патерн Builder для створення аналітичних звітів у LiteWebApp. Передбач Tree of Thoughts (ToT) з трьома варіантами: класичний Builder, Fluent Builder зі Strategy, комбінований Builder із шаблонами. Вкажи плюси/мінуси кожного, обґрунтуй вибір. Всі класи мають бути розділені за шарами: інтерфейс у Core/Interfaces, реалізація в Infrastructure/Data, шаблони та результати у Core/Entities."

**Варіанти:**
- V1: Класичний Builder для формування звіту по продажах (IReportBuilder, ConcreteReportBuilder, ReportDirector, Report, Controller, Views). Кожен новий тип звіту — новий Builder. Плюси: простота, мінімум коду. Мінуси: важко масштабувати, дублювання логіки.
- V2: Fluent Builder + Strategy для аналітики (IReportBuilder (Fluent), IReportStrategy, ReportService, Controller, Views). Плюси: гнучкість, розширюваність. Мінуси: складніше для старту, більше коду.
- V3: Комбінований Builder з шаблонами звітів (IReportBuilder (фільтри), ConcreteReportBuilder, ReportTemplate, ReportDirector, ReportResult (DTO), Controller, Views). Плюси: легко додавати нові шаблони, чистий код, мінімум дублювання. Мінуси: потребує чіткої організації шаблонів.

**Вибір:**
Обрано V3 — комбінований Builder із шаблонами, як оптимальний баланс між масштабованістю та простотою.

---

## [Активна] PROMPT v2.3.1: Виправлення помилок типів у Builder

**Опис:**
Виявлено проблему з видимістю типу ReportResult у IReportBuilder та невідповідністю підписів методів Build() у інтерфейсі та реалізації. Запропоновано три варіанти вирішення, з яких обрано оптимальний.

**Промпт:**
"Виправ помилки типів у патерні Builder: додай using LiteWebApp.Core.Entities; у IReportBuilder.cs для видимості ReportResult, вирівняй підписи методів Build() у IReportBuilder та ConcreteReportBuilder, перевір правильність просторів імен."

**Варіанти:**
- Варіант 1: Додати using LiteWebApp.Core.Entities; у IReportBuilder.cs, вирівняти типи повернення Build(). [Обрано]
- Варіант 2: Перемістити ReportResult у Core/Interfaces (порушує SRP).
- Варіант 3: Зробити Build() generic (Build<T>), але це ускладнює використання.

**Результат:**
Реалізовано Варіант 1 — типи вирівняно, простори імен підключено коректно.

---

## [Активна] PROMPT v2.3.1.1: Додавання пункту 'Аналітика' у меню

**Опис:**
Для покращення доступу до генератора звітів адміністратору додано пункт меню 'Аналітика' у Views/Shared/_Layout.cshtml. Це дозволяє швидко переходити до сторінки аналітичних звітів.

**Промпт:**
"Додай пункт меню 'Аналітика' для адміністратора у _Layout.cshtml для переходу на сторінку генератора звітів."

**Результат:**
Пункт меню з'явився лише для ролі адміністратора, веде на Report/Index.

---

## [Активна] PROMPT v2.3.1.2: Вирішення проблеми з шаблонами звітів

**Опис:**
Потрібно було реалізувати логіку для різних шаблонів звітів у Builder. Запропоновано три підходи, з яких обрано найзручніший для підтримки.

**Промпт:**
"Реалізуй логіку для кожного шаблону у ConcreteReportBuilder.Build(): SalesByStatus, TopProducts, SalesDynamicsByDay. Director передає шаблон у Build(), Builder обробляє відповідно."

**Варіанти:**
- Варіант 1: Логіка для кожного шаблону у Build() через switch по шаблону. [Обрано]
- Варіант 2: Окремі класи для кожного шаблону (ускладнює структуру).
- Варіант 3: Використати Strategy для шаблонів (надмірно для задачі).

**Результат:**
Реалізовано Варіант 1 — логіка для шаблонів у Build().

---

## [Активна] PROMPT v2.3.1.3: Виправлення логіки Builder для шаблонів

**Опис:**
Виникла потреба зберігати вибраний шаблон у Builder для коректної роботи з різними типами звітів. Запропоновано три підходи, обрано найзручніший.

**Промпт:**
"Передавай вибраний шаблон (ReportTemplate) у ConcreteReportBuilder через конструктор або SetTemplate(). Зберігай шаблон як поле _template. У Build() використовуй _template для вибору логіки."

**Варіанти:**
- Варіант 1: Зберігати шаблон у полі _template, використовувати у Build(). [Обрано]
- Варіант 2: Окремі Builder-класи для кожного шаблону.
- Варіант 3: Передавати шаблон у Build(ReportTemplate template) як параметр.

**Результат:**
Реалізовано Варіант 1 — шаблон зберігається у Builder, логіка Build() залежить від _template.

---

## [Активна] PROMPT v2.4: ToT-рефакторинг патерну Builder (підсумок)

**Опис:**
Проведено фінальний рефакторинг ConcreteReportBuilder згідно ToT-методики та принципу SRP. Вся логіка побудови шаблонів винесена у приватні методи (BuildByStatus, BuildTopProducts, BuildByDay). Назви колонок винесено у статичні поля. Додано XML-коментарі до всіх публічних методів. Повністю уникнуто використання var. Виправлено всі помилки компіляції після рефакторингу.

**Промпт:**
"Проведи повний ToT-рефакторинг ConcreteReportBuilder: винеси логіку шаблонів у приватні методи, всі константи — у статичні поля, додай XML-коментарі, уникай var, виправ всі помилки компіляції."

*Підсумок:**
- ConcreteReportBuilder.cs (v2.0, v2.3.1.3, v2.4)
- IReportBuilder.cs (v2.0, v2.3.1, v2.3.1.3)
- ReportTemplate.cs (v2.0)
- ReportResult.cs (v2.0)
- ReportDirector.cs (v2.0)
- Views/Report/Index.cshtml (v2.0)
- Views/Report/Result.cshtml (v2.0)
- Всі зміни та історія версій зафіксовані у цьому файлі.
- Код Builder повністю відповідає SRP, ToT, чистий, розширюваний.
- Всі шаблони звітів ізольовані, додавання нових — мінімальні зміни.
- Всі зміни задокументовано у PROMPT_HISTORY_v2.0_Builder.md.

---
